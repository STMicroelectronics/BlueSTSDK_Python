
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>blue_st_sdk.node &#8212; BlueSTSDK 1.4.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for blue_st_sdk.node</h1><div class="highlight"><pre>
<span></span><span class="c1">################################################################################</span>
<span class="c1"># COPYRIGHT(c) 2018 STMicroelectronics                                         #</span>
<span class="c1">#                                                                              #</span>
<span class="c1"># Redistribution and use in source and binary forms, with or without           #</span>
<span class="c1"># modification, are permitted provided that the following conditions are met:  #</span>
<span class="c1">#   1. Redistributions of source code must retain the above copyright notice,  #</span>
<span class="c1">#      this list of conditions and the following disclaimer.                   #</span>
<span class="c1">#   2. Redistributions in binary form must reproduce the above copyright       #</span>
<span class="c1">#      notice, this list of conditions and the following disclaimer in the     #</span>
<span class="c1">#      documentation and/or other materials provided with the distribution.    #</span>
<span class="c1">#   3. Neither the name of STMicroelectronics nor the names of its             #</span>
<span class="c1">#      contributors may be used to endorse or promote products derived from    #</span>
<span class="c1">#      this software without specific prior written permission.                #</span>
<span class="c1">#                                                                              #</span>
<span class="c1"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;  #</span>
<span class="c1"># AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE    #</span>
<span class="c1"># IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE   #</span>
<span class="c1"># ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE    #</span>
<span class="c1"># LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR          #</span>
<span class="c1"># CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF         #</span>
<span class="c1"># SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS     #</span>
<span class="c1"># INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN      #</span>
<span class="c1"># CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)      #</span>
<span class="c1"># ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE   #</span>
<span class="c1"># POSSIBILITY OF SUCH DAMAGE.                                                  #</span>
<span class="c1">################################################################################</span>


<span class="sd">&quot;&quot;&quot;node</span>

<span class="sd">The node module is responsible for managing a Bluetooth Low Energy (BLE) device/</span>
<span class="sd">node and allocating the needed resources.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="c1"># IMPORT</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="k">import</span> <span class="n">ABCMeta</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="k">import</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="k">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">bluepy.btle</span> <span class="k">import</span> <span class="n">Peripheral</span>
<span class="kn">from</span> <span class="nn">bluepy.btle</span> <span class="k">import</span> <span class="n">DefaultDelegate</span>
<span class="kn">from</span> <span class="nn">bluepy.btle</span> <span class="k">import</span> <span class="n">BTLEException</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="k">import</span> <span class="n">Enum</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">blue_st_sdk.manager</span>
<span class="kn">from</span> <span class="nn">blue_st_sdk.advertising_data.blue_st_advertising_data_parser</span> <span class="k">import</span> <span class="n">BlueSTAdvertisingDataParser</span>
<span class="kn">from</span> <span class="nn">blue_st_sdk.utils.ble_node_definitions</span> <span class="k">import</span> <span class="n">Debug</span>
<span class="kn">from</span> <span class="nn">blue_st_sdk.utils.ble_node_definitions</span> <span class="k">import</span> <span class="n">FeatureCharacteristic</span>
<span class="kn">from</span> <span class="nn">blue_st_sdk.utils.ble_node_definitions</span> <span class="k">import</span> <span class="n">TIMESTAMP_OFFSET_BYTES</span>
<span class="kn">from</span> <span class="nn">blue_st_sdk.utils.blue_st_exceptions</span> <span class="k">import</span> <span class="n">BlueSTInvalidAdvertisingDataException</span>
<span class="kn">from</span> <span class="nn">blue_st_sdk.utils.blue_st_exceptions</span> <span class="k">import</span> <span class="n">BlueSTInvalidOperationException</span>
<span class="kn">from</span> <span class="nn">blue_st_sdk.utils.blue_st_exceptions</span> <span class="k">import</span> <span class="n">BlueSTInvalidDataException</span>
<span class="kn">from</span> <span class="nn">blue_st_sdk.utils.uuid_to_feature_map</span> <span class="k">import</span> <span class="n">UUIDToFeatureMap</span>
<span class="kn">from</span> <span class="nn">blue_st_sdk.utils.number_conversion</span> <span class="k">import</span> <span class="n">LittleEndian</span>
<span class="kn">from</span> <span class="nn">blue_st_sdk.utils.unwrap_timestamp</span> <span class="k">import</span> <span class="n">UnwrapTimestamp</span>
<span class="kn">from</span> <span class="nn">blue_st_sdk.debug_console</span> <span class="k">import</span> <span class="n">DebugConsole</span>
<span class="kn">from</span> <span class="nn">blue_st_sdk.utils.python_utils</span> <span class="k">import</span> <span class="n">lock</span>


<span class="c1"># CLASSES</span>

<div class="viewcode-block" id="Node"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node">[docs]</a><span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="n">Peripheral</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Bluetooth Low Energy device class.</span>

<span class="sd">    This class allows exporting features using Bluetooth Low Energy (BLE)</span>
<span class="sd">    transmission.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_NOTIFICATION_ON</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;BB&quot;</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;Notifications ON.&quot;&quot;&quot;</span>

    <span class="n">_NOTIFICATION_OFF</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;BB&quot;</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;Notifications OFF.&quot;&quot;&quot;</span>

    <span class="n">_NUMBER_OF_THREADS</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="sd">&quot;&quot;&quot;Number of threads to be used to notify the listeners.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Node.__init__"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan_entry</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor.</span>

<span class="sd">        Args:</span>
<span class="sd">            scan_entry (ScanEntry): BLE device. It contains device information</span>
<span class="sd">                and advertising data. Refer to</span>
<span class="sd">                `ScanEntry &lt;https://ianharvey.github.io/bluepy-doc/scanentry.html&gt;`_</span>
<span class="sd">                for more information.</span>

<span class="sd">        Raises:</span>
<span class="sd">            :exc:`blue_st_sdk.utils.blue_st_exceptions.BlueSTInvalidAdvertisingDataException`</span>
<span class="sd">            is raised if the advertising data is not well formed.</span>
<span class="sd">            :exc:`blue_st_sdk.utils.blue_st_exceptions.BlueSTInvalidOperationException`</span>
<span class="sd">            is raised if the operation requested is not supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Creating an un-connected &quot;Peripheral&quot; object.</span>
        <span class="c1"># It is needed to call the &quot;connect()&quot; method on this object (passing a</span>
        <span class="c1"># device address) before it will be usable.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">Peripheral</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">BTLEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BlueSTInvalidOperationException</span><span class="p">(</span><span class="s1">&#39;Bluetooth invalid operation.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_friendly_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;Friendly name.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_last_rssi_update</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;Last update to the Received Signal Strength Indication.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">NodeStatus</span><span class="o">.</span><span class="n">INIT</span>
        <span class="sd">&quot;&quot;&quot;Status.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_thread_pool</span> <span class="o">=</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">Node</span><span class="o">.</span><span class="n">_NUMBER_OF_THREADS</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;Pool of thread used to notify the listeners.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_listeners</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;List of listeners to the node changes.</span>
<span class="sd">        It is a thread safe list, so a listener can subscribe itself through a</span>
<span class="sd">        callback.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_available_features</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;List of all the available features as claimed by the advertising data.</span>
<span class="sd">        (No duplicates.)&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mask_to_feature_dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;Mask to feature dictionary: there is an entry for each one-bit-high</span>
<span class="sd">        32-bit mask.&quot;&quot;&quot;</span>

        <span class="sd">&quot;&quot;&quot;UUID to list of external features dictionary: there is an entry for</span>
<span class="sd">        each list of exported external features.</span>
<span class="sd">        Note: A UUID may export more than one feature.</span>
<span class="sd">        Note: BlueSTSDK_Android: mExternalCharFeatures.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_external_uuid_to_features_dic</span> <span class="o">=</span> <span class="n">UUIDToFeatureMap</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_char_handle_to_features_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;Characteristic&#39;s handle to list of features dictionary: it tells</span>
<span class="sd">        which features to update when new data from a characteristic are</span>
<span class="sd">        received.</span>
<span class="sd">        Note: A UUID may export more than one feature.</span>
<span class="sd">        Note: The same feature may be added to different list of features in</span>
<span class="sd">              case more characteristics have the same corresponding bit set to</span>
<span class="sd">              high.</span>
<span class="sd">        Note: BlueSTSDK_Android: mCharFeatureMap.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_char_handle_to_characteristic_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;Characteristic&#39;s handle to characteristic dictionary.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_unwrap_timestamp</span> <span class="o">=</span> <span class="n">UnwrapTimestamp</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;Unwrap timestamp reference.&quot;&quot;&quot;</span>

        <span class="c1">#self._characteristic_write_queue = Queue()</span>
        <span class="sd">&quot;&quot;&quot;Queue of write jobs.&quot;&quot;&quot;</span>

        <span class="c1"># Debug console used to read/write debug messages from/to the Bluetooth</span>
        <span class="c1"># device. None if the device doesn&#39;t export the debug service.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_debug_console</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Advertising data.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_device</span> <span class="o">=</span> <span class="n">scan_entry</span>
            <span class="sd">&quot;&quot;&quot;BLE device.</span>
<span class="sd">            Python&#39;s &quot;ScanEntry&quot; object, equivalent to Android&#39;s &quot;BluetoothDevice&quot;</span>
<span class="sd">            object.&quot;&quot;&quot;</span>

            <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_advertising_data</span> <span class="o">=</span> <span class="n">BlueSTAdvertisingDataParser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
                    <span class="n">scan_entry</span><span class="o">.</span><span class="n">getScanData</span><span class="p">())</span>
                <span class="sd">&quot;&quot;&quot;Advertising data.&quot;&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_rssi</span> <span class="o">=</span> <span class="n">scan_entry</span><span class="o">.</span><span class="n">rssi</span>
            <span class="sd">&quot;&quot;&quot;Received Signal Strength Indication.&quot;&quot;&quot;</span>
        <span class="k">except</span> <span class="n">BlueSTInvalidAdvertisingDataException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="n">BTLEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BlueSTInvalidOperationException</span><span class="p">(</span><span class="s1">&#39;Bluetooth invalid operation.&#39;</span><span class="p">)</span>

        <span class="c1"># Updating node.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_rssi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rssi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_node_status</span><span class="p">(</span><span class="n">NodeStatus</span><span class="o">.</span><span class="n">IDLE</span><span class="p">)</span>

        <span class="c1"># Building available features.</span></div>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_available_features</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_build_feature_from_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_class</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a feature object from the given class.</span>

<span class="sd">        Args:</span>
<span class="sd">            feature_class (class): Feature class to instantiate.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            :class:`blue_st_sdk.feature.Feature`: The feature object built if</span>
<span class="sd">            the feature class is valid, &quot;None&quot; otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">feature_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">feature_class</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_build_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">characteristic</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build the exported features of a BLE characteristic.</span>

<span class="sd">        After building the features, add them to the dictionary of the features</span>
<span class="sd">        to be updated.</span>

<span class="sd">        Args:</span>
<span class="sd">            characteristic (Characteristic): The BLE characteristic. Refer to</span>
<span class="sd">            `Characteristic &lt;https://ianharvey.github.io/bluepy-doc/characteristic.html&gt;`_</span>
<span class="sd">            for more information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Extracting the feature mask from the characteristic&#39;s UUID.</span>
            <span class="n">feature_mask</span> <span class="o">=</span> <span class="n">FeatureCharacteristic</span><span class="o">.</span><span class="n">extract_feature_mask</span><span class="p">(</span>
                <span class="n">characteristic</span><span class="o">.</span><span class="n">uuid</span><span class="p">)</span>
            <span class="c1"># Looking for the exported features in reverse order to get them in</span>
            <span class="c1"># the correct order in case of characteristic that exports multiple</span>
            <span class="c1"># features.</span>
            <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">31</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">32</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">feature_mask</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">mask</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask_to_feature_dic</span><span class="p">:</span>
                        <span class="n">feature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask_to_feature_dic</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">feature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">feature</span><span class="o">.</span><span class="n">set_enable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                            <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>

            <span class="c1"># If the features are valid, add an entry for the corresponding</span>
            <span class="c1"># characteristic.</span>
            <span class="k">if</span> <span class="n">features</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_char_handle_to_features_dict</span><span class="p">[</span>
                        <span class="n">characteristic</span><span class="o">.</span><span class="n">getHandle</span><span class="p">()]</span> <span class="o">=</span> <span class="n">features</span>
        <span class="k">except</span> <span class="n">BTLEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_node</span><span class="o">.</span><span class="n">_unexpected_disconnect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_build_features_known_uuid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">characteristic</span><span class="p">,</span> <span class="n">feature_classes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build the given features of a BLE characteristic.</span>

<span class="sd">        After building the features, add them to the dictionary of the features</span>
<span class="sd">        to be updated.</span>

<span class="sd">        Args:</span>
<span class="sd">            characteristic (Characteristic): The BLE characteristic. Refer to</span>
<span class="sd">            `Characteristic &lt;https://ianharvey.github.io/bluepy-doc/characteristic.html&gt;`_</span>
<span class="sd">            for more information.</span>
<span class="sd">            feature_classes (list): The list of feature-classes to instantiate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Build the features.</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">feature_class</span> <span class="ow">in</span> <span class="n">feature_classes</span><span class="p">:</span>
            <span class="n">feature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_feature_from_class</span><span class="p">(</span><span class="n">feature_class</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">feature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">feature</span><span class="o">.</span><span class="n">set_enable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_available_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

        <span class="c1"># If the features are valid, add an entry for the corresponding</span>
        <span class="c1"># characteristic.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">features</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_char_handle_to_features_dict</span><span class="p">[</span>
                        <span class="n">characteristic</span><span class="o">.</span><span class="n">getHandle</span><span class="p">()]</span> <span class="o">=</span> <span class="n">features</span>
        <span class="k">except</span> <span class="n">BTLEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unexpected_disconnect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_build_available_features</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build available features as claimed by the advertising data.</span>

<span class="sd">        Build a list of possible features that this node can export by</span>
<span class="sd">        relying on the advertising data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Getting device identifier and feature mask from advertising data.</span>
        <span class="n">device_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_advertising_data</span><span class="o">.</span><span class="n">get_device_id</span><span class="p">()</span>
        <span class="n">feature_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_advertising_data</span><span class="o">.</span><span class="n">get_feature_mask</span><span class="p">()</span>

        <span class="c1"># Getting the dictionary that maps feature-masks to feature-classes</span>
        <span class="c1"># related to the advertising data&#39;s device identifier.</span>
        <span class="n">decoder</span> <span class="o">=</span> <span class="n">blue_st_sdk</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">Manager</span><span class="o">.</span><span class="n">get_node_features</span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span>

        <span class="c1"># Initializing list of available-features and mask-to-feature</span>
        <span class="c1"># dictionary.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_available_features</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mask_to_feature_dic</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Building features as claimed by the advertising data&#39;s feature-mask.</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">32</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">feature_mask</span> <span class="o">&amp;</span> <span class="n">mask</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">feature_class</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">feature_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">feature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_feature_from_class</span><span class="p">(</span><span class="n">feature_class</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">feature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_available_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_mask_to_feature_dic</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Impossible to build the feature </span><span class="se">\&quot;</span><span class="s1">&#39;</span>
                            <span class="o">+</span> <span class="n">feature_class</span><span class="o">.</span><span class="n">get_simple_name</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">.&#39;</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_set_features_characteristics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For each feature stores a reference to its characteristic.</span>

<span class="sd">        It is useful to enable/disable notifications on the characteristic</span>
<span class="sd">        itself.</span>

<span class="sd">        By design, the characteristic that offers more features beyond the</span>
<span class="sd">        feature is selected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_available_features</span><span class="p">:</span>
            <span class="n">features_size</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_char_handle_to_features_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">char_handle</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">features</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">feature</span><span class="o">.</span><span class="n">_characteristic</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">feature</span><span class="o">.</span><span class="n">_characteristic</span> <span class="o">=</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">_char_handle_to_characteristic_dict</span><span class="p">[</span><span class="n">char_handle</span><span class="p">]</span>
                        <span class="n">features_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">features_size</span><span class="p">:</span>
                            <span class="n">feature</span><span class="o">.</span><span class="n">_characteristic</span> <span class="o">=</span> \
                                <span class="bp">self</span><span class="o">.</span><span class="n">_char_handle_to_characteristic_dict</span><span class="p">[</span><span class="n">char_handle</span><span class="p">]</span>
                            <span class="n">features_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char_handle</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">notify_update</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the features related to a given characteristic.</span>

<span class="sd">        Args:</span>
<span class="sd">            char_handle (int): The characteristic&#39;s handle to look for.</span>
<span class="sd">            data (str): The data read from the given characteristic.</span>
<span class="sd">            notify_update (bool, optional): If True all the registered listeners</span>
<span class="sd">            are notified about the new data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the characteristic has some features associated to it</span>
<span class="sd">            and they have been updated, False otherwise.</span>

<span class="sd">        Raises:</span>
<span class="sd">            :exc:`blue_st_sdk.utils.blue_st_exceptions.BlueSTInvalidDataException`</span>
<span class="sd">            if the data array has not enough data to read.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Getting the features corresponding to the given characteristic.</span>
        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_corresponding_features</span><span class="p">(</span><span class="n">char_handle</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Computing the timestamp.</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unwrap_timestamp</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span>
            <span class="n">LittleEndian</span><span class="o">.</span><span class="n">bytes_to_uint16</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

        <span class="c1"># Updating the features.</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">TIMESTAMP_OFFSET_BYTES</span>  <span class="c1"># Timestamp sixe in bytes.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="n">feature</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">notify_update</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">BlueSTInvalidDataException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_get_corresponding_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char_handle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the features corresponding to the given characteristic.</span>

<span class="sd">        Args:</span>
<span class="sd">            char_handle (int): The characteristic&#39;s handle to look for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: The list of features associated to the given characteristic,</span>
<span class="sd">            None if the characteristic does not exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">char_handle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_char_handle_to_features_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_char_handle_to_features_dict</span><span class="p">[</span><span class="n">char_handle</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_update_node_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_status</span><span class="p">,</span> <span class="n">unexpected</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the status of the node.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_status (:class:`blue_st_sdk.node.NodeStatus`): New status.</span>
<span class="sd">            unexpected (bool, optional): True if the new status is unexpected,</span>
<span class="sd">                False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">old_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">new_status</span>
        <span class="k">for</span> <span class="n">listener</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_listeners</span><span class="p">:</span>
            <span class="c1"># Calling user-defined callback.</span>
            <span class="c1"># self._thread_pool.submit(</span>
            <span class="c1">#     listener.on_status_change(</span>
            <span class="c1">#         self, new_status.value, old_status.value))</span>
            <span class="k">if</span> <span class="n">new_status</span> <span class="o">==</span> <span class="n">NodeStatus</span><span class="o">.</span><span class="n">CONNECTED</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_thread_pool</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                    <span class="n">listener</span><span class="o">.</span><span class="n">on_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">new_status</span> <span class="o">==</span> <span class="n">NodeStatus</span><span class="o">.</span><span class="n">IDLE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_thread_pool</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                    <span class="n">listener</span><span class="o">.</span><span class="n">on_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unexpected</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_update_rssi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rssi</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the RSSI value.</span>

<span class="sd">        Args:</span>
<span class="sd">            rssi (int): New RSSI value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rssi</span> <span class="o">=</span> <span class="n">rssi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_rssi_update</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="c1">#if self._status == NodeStatus.LOST:</span>
        <span class="c1">#    self._update_node_status(NodeStatus.IDLE)</span>

    <span class="k">def</span> <span class="nf">_build_debug_console</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debug_service</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build a debug console used to read/write debug messages from/to the</span>
<span class="sd">        Bluetooth device.</span>

<span class="sd">        Args:</span>
<span class="sd">            debug_service (Service): The BLE service. Refer to</span>
<span class="sd">            `Service &lt;https://ianharvey.github.io/bluepy-doc/service.html&gt;`_</span>
<span class="sd">            for more information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            :class:`blue_st_sdk.debug_console.DebugConsole`: A debug console</span>
<span class="sd">            used to read/write debug messages from/to the Bluetooth device.</span>
<span class="sd">            None if the device doesn&#39;t export the needed characteristics.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stdinout</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">stderr</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">characteristics</span> <span class="o">=</span> <span class="n">debug_service</span><span class="o">.</span><span class="n">getCharacteristics</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">characteristic</span> <span class="ow">in</span> <span class="n">characteristics</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">characteristic</span><span class="o">.</span><span class="n">uuid</span><span class="p">)</span> <span class="o">==</span> \
                    <span class="nb">str</span><span class="p">(</span><span class="n">Debug</span><span class="o">.</span><span class="n">DEBUG_STDINOUT_BLUESTSDK_SERVICE_UUID</span><span class="p">):</span>
                    <span class="n">stdinout</span> <span class="o">=</span> <span class="n">characteristic</span>
                <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">characteristic</span><span class="o">.</span><span class="n">uuid</span><span class="p">)</span> <span class="o">==</span> \
                    <span class="nb">str</span><span class="p">(</span><span class="n">Debug</span><span class="o">.</span><span class="n">DEBUG_STDERR_BLUESTSDK_SERVICE_UUID</span><span class="p">):</span>
                    <span class="n">stderr</span> <span class="o">=</span> <span class="n">characteristic</span>
                <span class="k">if</span> <span class="n">stdinout</span> <span class="ow">and</span> <span class="n">stderr</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">DebugConsole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stdinout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="n">BTLEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unexpected_disconnect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_unexpected_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handle an unexpected disconnection.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Disconnecting.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_node_status</span><span class="p">(</span><span class="n">NodeStatus</span><span class="o">.</span><span class="n">UNREACHABLE</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">Node</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_node_status</span><span class="p">(</span><span class="n">NodeStatus</span><span class="o">.</span><span class="n">IDLE</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">BTLEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>

<div class="viewcode-block" id="Node.connect"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_defined_features</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open a connection to the node.</span>

<span class="sd">        Please note that there is no supervision timeout API within the SDK,</span>
<span class="sd">        hence it is not possible to detect immediately an unexpected</span>
<span class="sd">        disconnection; it is detected and notified via listeners as soon as a</span>
<span class="sd">        read/write/notify operation is executed on the device (limitation</span>
<span class="sd">        intrinsic to the bluepy library).</span>

<span class="sd">        Args:</span>
<span class="sd">            user_defined_features (dict, optional): User-defined feature to be</span>
<span class="sd">            added.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the connection to the node has been successful, False</span>
<span class="sd">            otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">==</span> <span class="n">NodeStatus</span><span class="o">.</span><span class="n">IDLE</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Creating a delegate object, which is called when asynchronous</span>
            <span class="c1"># events such as Bluetooth notifications occur.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">withDelegate</span><span class="p">(</span><span class="n">NodeDelegate</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

            <span class="c1"># Connecting.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_node_status</span><span class="p">(</span><span class="n">NodeStatus</span><span class="o">.</span><span class="n">CONNECTING</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_external_features</span><span class="p">(</span><span class="n">user_defined_features</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">Node</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_tag</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="o">.</span><span class="n">addrType</span><span class="p">)</span>

            <span class="c1"># Getting services.</span>
            <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">services</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getServices</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">services</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Handling Debug, Config, and Feature characteristics.</span>
            <span class="k">for</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">services</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Debug</span><span class="o">.</span><span class="n">is_debug_service</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">service</span><span class="o">.</span><span class="n">uuid</span><span class="p">)):</span>
                    <span class="c1"># Handling Debug.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_debug_console</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_debug_console</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
                <span class="c1">#elif Config.is_config_service(str(service.uuid)):</span>
                    <span class="c1"># Handling Config.</span>
                <span class="c1">#    pass</span>
                <span class="c1">#else:</span>
                <span class="c1"># Getting characteristics.</span>
                <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="n">characteristics</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">getCharacteristics</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">characteristic</span> <span class="ow">in</span> <span class="n">characteristics</span><span class="p">:</span>

                    <span class="c1"># Storing characteristics&#39; handle to characteristic mapping.</span>
                    <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_char_handle_to_characteristic_dict</span><span class="p">[</span>
                            <span class="n">characteristic</span><span class="o">.</span><span class="n">getHandle</span><span class="p">()]</span> <span class="o">=</span> <span class="n">characteristic</span>

                    <span class="c1"># Building characteristics&#39; features.</span>
                    <span class="k">if</span> <span class="n">FeatureCharacteristic</span><span class="o">.</span><span class="n">is_base_feature_characteristic</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">characteristic</span><span class="o">.</span><span class="n">uuid</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_build_features</span><span class="p">(</span><span class="n">characteristic</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">FeatureCharacteristic</span><span class="o">.</span><span class="n">is_extended_feature_characteristic</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">characteristic</span><span class="o">.</span><span class="n">uuid</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_build_features_known_uuid</span><span class="p">(</span>
                            <span class="n">characteristic</span><span class="p">,</span>
                            <span class="p">[</span><span class="n">FeatureCharacteristic</span><span class="o">.</span><span class="n">get_extended_feature_class</span><span class="p">(</span>
                                <span class="n">characteristic</span><span class="o">.</span><span class="n">uuid</span><span class="p">)])</span>
                    <span class="k">elif</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_external_uuid_to_features_dic</span><span class="p">)</span> \
                        <span class="ow">and</span> <span class="n">characteristic</span><span class="o">.</span><span class="n">uuid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_external_uuid_to_features_dic</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_build_features_known_uuid</span><span class="p">(</span>
                            <span class="n">characteristic</span><span class="p">,</span>
                            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_external_uuid_to_features_dic</span><span class="p">[</span>
                            <span class="n">characteristic</span><span class="o">.</span><span class="n">uuid</span><span class="p">]])</span>

            <span class="c1"># For each feature store a reference to the characteristic offering the</span>
            <span class="c1"># feature, useful to enable/disable notifications on the characteristic</span>
            <span class="c1"># itself.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_features_characteristics</span><span class="p">()</span>

            <span class="c1"># Change node&#39;s status.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_node_status</span><span class="p">(</span><span class="n">NodeStatus</span><span class="o">.</span><span class="n">CONNECTED</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">==</span> <span class="n">NodeStatus</span><span class="o">.</span><span class="n">CONNECTED</span>
        <span class="k">except</span> <span class="n">BTLEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span></div>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unexpected_disconnect</span><span class="p">()</span>

<div class="viewcode-block" id="Node.disconnect"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.disconnect">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close the connection to the node.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the disconnection to the node has been successful,</span>
<span class="sd">            False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Disconnecting.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_node_status</span><span class="p">(</span><span class="n">NodeStatus</span><span class="o">.</span><span class="n">DISCONNECTING</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">Node</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_node_status</span><span class="p">(</span><span class="n">NodeStatus</span><span class="o">.</span><span class="n">IDLE</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">==</span> <span class="n">NodeStatus</span><span class="o">.</span><span class="n">IDLE</span>
        <span class="k">except</span> <span class="n">BTLEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span></div>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unexpected_disconnect</span><span class="p">()</span>

<div class="viewcode-block" id="Node.add_external_features"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.add_external_features">[docs]</a>    <span class="k">def</span> <span class="nf">add_external_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_defined_features</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add available features to an already discovered device.</span>

<span class="sd">        This method has effect only if called before connecting to the node.</span>
<span class="sd">        </span>
<span class="sd">        If a UUID is already known, it will be overwritten with the new list of</span>
<span class="sd">        available features.</span>

<span class="sd">        Otherwise, it is possible to add available features before performing</span>
<span class="sd">        the discovery process (see </span>
<span class="sd">        :meth:`blue_st_sdk.manager.Manager.addFeaturesToNode()` method).</span>

<span class="sd">        Args:</span>
<span class="sd">            user_defined_features (dict): User-defined feature to be added.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Example:</span>
        <span class="c1"># # Adding a &#39;FeatureHeartRate&#39; feature to a Nucleo device and mapping</span>
        <span class="c1"># # it to the standard &#39;00002a37-0000-1000-8000-00805f9b34fb&#39; Heart Rate</span>
        <span class="c1"># # Measurement characteristic.</span>
        <span class="c1"># map = UUIDToFeatureMap()</span>
        <span class="c1"># map.put(uuid.UUID(&#39;00002a37-0000-1000-8000-00805f9b34fb&#39;),</span>
        <span class="c1">#         feature_heart_rate.FeatureHeartRate)</span>
        <span class="c1"># node.add_external_features(map)</span>
        <span class="c1"># # Connecting to the node.</span>
        <span class="c1"># node.connect()</span>

        <span class="k">if</span> <span class="n">user_defined_features</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span></div>
            <span class="bp">self</span><span class="o">.</span><span class="n">_external_uuid_to_features_dic</span><span class="o">.</span><span class="n">put_all</span><span class="p">(</span><span class="n">user_defined_features</span><span class="p">)</span>

<div class="viewcode-block" id="Node.get_tag"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.get_tag">[docs]</a>    <span class="k">def</span> <span class="nf">get_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the tag of the node.</span>

<span class="sd">        The tag is a unique identification, i.e. its MAC address.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The MAC address of the node (hexadecimal string separated by</span>
<span class="sd">            colons).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="o">.</span><span class="n">addr</span>
        <span class="k">except</span> <span class="n">BTLEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span></div>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unexpected_disconnect</span><span class="p">()</span>

<div class="viewcode-block" id="Node.get_status"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.get_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the status of the node.</span>

<span class="sd">        Returns:</span>
<span class="sd">            :class:`blue_st_sdk.node.NodeStatus`: The status of the node.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span>

<div class="viewcode-block" id="Node.get_name"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the name of the node.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The name of the node.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_advertising_data</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>

<div class="viewcode-block" id="Node.get_friendly_name"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.get_friendly_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_friendly_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a friendly name of the node.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: A friendly name of the node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_friendly_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tag</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tag_clean</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_friendly_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>\
                <span class="o">+</span> <span class="s2">&quot; @&quot;</span>\
                <span class="o">+</span> <span class="n">tag_clean</span><span class="o">.</span><span class="n">substring</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">tag_clean</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">tag_clean</span><span class="o">.</span><span class="n">length</span><span class="p">()),</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">tag_clean</span><span class="p">)</span>
                <span class="p">)</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_friendly_name</span>

<div class="viewcode-block" id="Node.get_type"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.get_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the type of the node.</span>

<span class="sd">        Returns:</span>
<span class="sd">            :class:`blue_st_sdk.node.NodeType`: The type of the node.</span>

<span class="sd">        Raises:</span>
<span class="sd">            :exc:`blue_st_sdk.utils.blue_st_exceptions.BlueSTInvalidAdvertisingDataException`</span>
<span class="sd">            if the device type is unknown.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_advertising_data</span><span class="o">.</span><span class="n">get_device_type</span><span class="p">()</span>

<div class="viewcode-block" id="Node.get_type_id"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.get_type_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_type_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the type identifier of the node.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The type identifier of the node.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_advertising_data</span><span class="o">.</span><span class="n">get_device_id</span><span class="p">()</span>

<div class="viewcode-block" id="Node.get_protocol_version"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.get_protocol_version">[docs]</a>    <span class="k">def</span> <span class="nf">get_protocol_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the device Protocol Version.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            int: The device Protocol Version.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_advertising_data</span><span class="o">.</span><span class="n">get_protocol_version</span><span class="p">()</span>

<div class="viewcode-block" id="Node.get_features"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.get_features">[docs]</a>    <span class="k">def</span> <span class="nf">get_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_class</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the list of features.</span>

<span class="sd">        Get the list of available features in the advertising data, or the list</span>
<span class="sd">        of features of the specific type (class name) if given.</span>

<span class="sd">        Args:</span>
<span class="sd">            feature_class (class, optional): Type (class name) of the feature to</span>
<span class="sd">            search for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of features. An empty list if no features are found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">feature_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_available_features</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_available_features</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">feature_class</span><span class="p">):</span>
                    <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span></div>
        <span class="k">return</span> <span class="n">features</span>

<div class="viewcode-block" id="Node.get_feature"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.get_feature">[docs]</a>    <span class="k">def</span> <span class="nf">get_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_class</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a feature of the given type (class name).</span>

<span class="sd">        Args:</span>
<span class="sd">            feature_class (class): Type (class name) of the feature to search</span>
<span class="sd">            for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The feature of the given type (class name) if exported by this node,</span>
<span class="sd">            &quot;None&quot; otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span><span class="n">feature_class</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>
        <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="Node.get_tx_power_level"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.get_tx_power_level">[docs]</a>    <span class="k">def</span> <span class="nf">get_tx_power_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the node transmission power in mdb.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The node transmission power in mdb.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_advertising_data</span><span class="o">.</span><span class="n">get_tx_power</span><span class="p">()</span>

<div class="viewcode-block" id="Node.get_last_rssi"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.get_last_rssi">[docs]</a>    <span class="k">def</span> <span class="nf">get_last_rssi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the most recent value of RSSI.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The last known RSSI value.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rssi</span>

<div class="viewcode-block" id="Node.get_last_rssi_update_date"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.get_last_rssi_update_date">[docs]</a>    <span class="k">def</span> <span class="nf">get_last_rssi_update_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the time of the last RSSI update received.</span>

<span class="sd">        Returns:</span>
<span class="sd">            datetime: The time of the last RSSI update received. Refer to</span>
<span class="sd">            `datetime &lt;https://docs.python.org/2/library/datetime.html&gt;`_</span>
<span class="sd">            for more information.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_rssi_update</span>

<div class="viewcode-block" id="Node.is_connected"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.is_connected">[docs]</a>    <span class="k">def</span> <span class="nf">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check whether the node is connected.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the node is connected, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">==</span> <span class="n">NodeStatus</span><span class="o">.</span><span class="n">CONNECTED</span>

<div class="viewcode-block" id="Node.is_sleeping"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.is_sleeping">[docs]</a>    <span class="k">def</span> <span class="nf">is_sleeping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check whether the node is sleeping.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the node is sleeping, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_advertising_data</span><span class="o">.</span><span class="n">is_board_sleeping</span><span class="p">()</span>

<div class="viewcode-block" id="Node.is_alive"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.is_alive">[docs]</a>    <span class="k">def</span> <span class="nf">is_alive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rssi</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check whether the node is alive.</span>

<span class="sd">        To be called whenever the :class:`blue_st_sdk.manager.Manager` class</span>
<span class="sd">        receives a new advertising data from this node.</span>

<span class="sd">        Args:</span>
<span class="sd">            rssi (int): The RSSI of the last advertising data.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_rssi</span><span class="p">(</span><span class="n">rssi</span><span class="p">)</span>

<div class="viewcode-block" id="Node.get_advertising_data"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.get_advertising_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_advertising_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update advertising data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            :class:`blue_st_sdk.advertising_data.blue_st_advertising_data.BlueSTAdvertisingData`:</span>
<span class="sd">            Formatted Blue ST Advertising Data object.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_advertising_data</span>

<div class="viewcode-block" id="Node.update_advertising_data"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.update_advertising_data">[docs]</a>    <span class="k">def</span> <span class="nf">update_advertising_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">advertising_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update advertising data.</span>

<span class="sd">        Args:</span>
<span class="sd">            advertising_data (list): Advertising data. Refer to &#39;getScanData()&#39;</span>
<span class="sd">            method of</span>
<span class="sd">            `ScanEntry &lt;https://ianharvey.github.io/bluepy-doc/scanentry.html&gt;`_</span>
<span class="sd">            class for more information.</span>

<span class="sd">        Raises:</span>
<span class="sd">            :exc:`blue_st_sdk.utils.blue_st_exceptions.BlueSTInvalidAdvertisingDataException`</span>
<span class="sd">            is raised if the advertising data is not well formed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_advertising_data</span> <span class="o">=</span> <span class="n">BlueSTAdvertisingDataParser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
                <span class="n">advertising_data</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">BlueSTInvalidAdvertisingDataException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span></div>
            <span class="k">raise</span> <span class="n">e</span>

<div class="viewcode-block" id="Node.equals"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compare the current node with the given one.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the current node is equal to the given node, False</span>
<span class="sd">            otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Node</span><span class="p">)</span>\</div>
               <span class="ow">and</span> <span class="p">(</span><span class="n">node</span> <span class="o">==</span> <span class="bp">self</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tag</span><span class="p">()</span> <span class="o">==</span> <span class="n">node</span><span class="o">.</span><span class="n">get_tag</span><span class="p">())</span>

<div class="viewcode-block" id="Node.characteristic_can_be_read"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.characteristic_can_be_read">[docs]</a>    <span class="k">def</span> <span class="nf">characteristic_can_be_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">characteristic</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if a characteristics can be read.</span>

<span class="sd">        Args:</span>
<span class="sd">            characteristic (Characteristic): The BLE characteristic to check.</span>
<span class="sd">            Refer to</span>
<span class="sd">            `Characteristic &lt;https://ianharvey.github.io/bluepy-doc/characteristic.html&gt;`_</span>
<span class="sd">            for more information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the characteristic can be read, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">characteristic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="k">return</span> <span class="s2">&quot;READ&quot;</span> <span class="ow">in</span> <span class="n">characteristic</span><span class="o">.</span><span class="n">propertiesToString</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="n">BTLEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span></div>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unexpected_disconnect</span><span class="p">()</span>

<div class="viewcode-block" id="Node.characteristic_can_be_written"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.characteristic_can_be_written">[docs]</a>    <span class="k">def</span> <span class="nf">characteristic_can_be_written</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">characteristic</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if a characteristics can be written.</span>

<span class="sd">        Args:</span>
<span class="sd">            characteristic (Characteristic): The BLE characteristic to check.</span>
<span class="sd">            Refer to</span>
<span class="sd">            `Characteristic &lt;https://ianharvey.github.io/bluepy-doc/characteristic.html&gt;`_</span>
<span class="sd">            for more information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the characteristic can be written, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">characteristic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="k">return</span> <span class="s2">&quot;WRITE&quot;</span> <span class="ow">in</span> <span class="n">characteristic</span><span class="o">.</span><span class="n">propertiesToString</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="n">BTLEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span></div>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unexpected_disconnect</span><span class="p">()</span>

<div class="viewcode-block" id="Node.characteristic_can_be_notified"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.characteristic_can_be_notified">[docs]</a>    <span class="k">def</span> <span class="nf">characteristic_can_be_notified</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">characteristic</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if a characteristics can be notified.</span>

<span class="sd">        Args:</span>
<span class="sd">            characteristic (Characteristic): The BLE characteristic to check.</span>
<span class="sd">            Refer to</span>
<span class="sd">            `Characteristic &lt;https://ianharvey.github.io/bluepy-doc/characteristic.html&gt;`_</span>
<span class="sd">            for more information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the characteristic can be notified, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">characteristic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="k">return</span> <span class="s2">&quot;NOTIFY&quot;</span> <span class="ow">in</span> <span class="n">characteristic</span><span class="o">.</span><span class="n">propertiesToString</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="n">BTLEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span></div>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unexpected_disconnect</span><span class="p">()</span>

<div class="viewcode-block" id="Node.read_feature"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.read_feature">[docs]</a>    <span class="k">def</span> <span class="nf">read_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Synchronous request to read a feature.</span>

<span class="sd">        Args:</span>
<span class="sd">            feature (:class:`blue_st_sdk.feature.Feature`): The feature to read.</span>

<span class="sd">        Raises:</span>
<span class="sd">            :exc:`blue_st_sdk.utils.blue_st_exceptions.BlueSTInvalidOperationException`</span>
<span class="sd">            is raised if the feature is not enabled or the operation</span>
<span class="sd">            required is not supported.</span>
<span class="sd">            :exc:`blue_st_sdk.utils.blue_st_exceptions.BlueSTInvalidDataException`</span>
<span class="sd">            if the data array has not enough data to read.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">feature</span><span class="o">.</span><span class="n">is_enabled</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">BlueSTInvalidOperationException</span><span class="p">(</span>
                <span class="s1">&#39; The &quot;&#39;</span> <span class="o">+</span> <span class="n">feature</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;&quot; feature is not enabled.&#39;</span><span class="p">)</span>

        <span class="n">characteristic</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">get_characteristic</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">characteristic_can_be_read</span><span class="p">(</span><span class="n">characteristic</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">BlueSTInvalidOperationException</span><span class="p">(</span>
                <span class="s1">&#39; The &quot;&#39;</span> <span class="o">+</span> <span class="n">feature</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;&quot; feature is not readable.&#39;</span><span class="p">)</span>

        <span class="c1"># Reading data.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">char_handle</span> <span class="o">=</span> <span class="n">characteristic</span><span class="o">.</span><span class="n">getHandle</span><span class="p">()</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readCharacteristic</span><span class="p">(</span><span class="n">char_handle</span><span class="p">)</span>

            <span class="c1"># Calling on-read callback.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug_console</span> <span class="ow">and</span> \
                <span class="n">Debug</span><span class="o">.</span><span class="n">is_debug_characteristic</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">characteristic</span><span class="o">.</span><span class="n">uuid</span><span class="p">)):</span>
                <span class="c1"># Calling on-read callback for a debug characteristic.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_debug_console</span><span class="o">.</span><span class="n">on_update_characteristic</span><span class="p">(</span>
                    <span class="n">characteristic</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Calling on-read callback for the other characteristics.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_features</span><span class="p">(</span><span class="n">char_handle</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">BlueSTInvalidDataException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="n">BTLEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span></div>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unexpected_disconnect</span><span class="p">()</span>

<div class="viewcode-block" id="Node.write_feature"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.write_feature">[docs]</a>    <span class="k">def</span> <span class="nf">write_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Synchronous request to write a feature.</span>

<span class="sd">        Args:</span>
<span class="sd">            feature (:class:`blue_st_sdk.feature.Feature`): The feature to</span>
<span class="sd">            write.</span>
<span class="sd">            data (str): The data to be written.</span>

<span class="sd">        Raises:</span>
<span class="sd">            :exc:`blue_st_sdk.utils.blue_st_exceptions.BlueSTInvalidOperationException`</span>
<span class="sd">            is raised if the feature is not enabled or the operation</span>
<span class="sd">            required is not supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">feature</span><span class="o">.</span><span class="n">is_enabled</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">BlueSTInvalidOperationException</span><span class="p">(</span>
                <span class="s1">&#39; The &quot;&#39;</span> <span class="o">+</span> <span class="n">feature</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;&quot; feature is not enabled.&#39;</span><span class="p">)</span>

        <span class="n">characteristic</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">get_characteristic</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">characteristic_can_be_written</span><span class="p">(</span><span class="n">characteristic</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">BlueSTInvalidOperationException</span><span class="p">(</span>
                <span class="s1">&#39; The &quot;&#39;</span> <span class="o">+</span> <span class="n">feature</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;&quot; feature is not writeable.&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">char_handle</span> <span class="o">=</span> <span class="n">characteristic</span><span class="o">.</span><span class="n">getHandle</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">writeCharacteristic</span><span class="p">(</span><span class="n">char_handle</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">BTLEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span></div>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unexpected_disconnect</span><span class="p">()</span>

<div class="viewcode-block" id="Node.set_notification_status"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.set_notification_status">[docs]</a>    <span class="k">def</span> <span class="nf">set_notification_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">characteristic</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ask the node to set the notification status of the given</span>
<span class="sd">        characteristic.</span>

<span class="sd">        Args:</span>
<span class="sd">            characteristic (Characteristic): The BLE characteristic to check.</span>
<span class="sd">            Refer to</span>
<span class="sd">            `Characteristic &lt;https://ianharvey.github.io/bluepy-doc/characteristic.html&gt;`_</span>
<span class="sd">            for more information.</span>
<span class="sd">            status (bool): True if the notifications have to be turned on, False</span>
<span class="sd">            otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">writeCharacteristic</span><span class="p">(</span><span class="n">characteristic</span><span class="o">.</span><span class="n">getHandle</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_NOTIFICATION_ON</span> <span class="k">if</span> <span class="n">status</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NOTIFICATION_OFF</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">BTLEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span></div>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unexpected_disconnect</span><span class="p">()</span>

<div class="viewcode-block" id="Node.enable_notifications"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.enable_notifications">[docs]</a>    <span class="k">def</span> <span class="nf">enable_notifications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ask the node to notify when a feature updates its value.</span>

<span class="sd">        The received values are notified thought a feature listener.</span>

<span class="sd">        Args:</span>
<span class="sd">            feature (:class:`blue_st_sdk.feature.Feature`): The given feature.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: False if the feature is not handled by this node, or it is</span>
<span class="sd">            disabled, or it is not possible to turn notifications on for it,</span>
<span class="sd">            True otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">feature</span><span class="o">.</span><span class="n">is_enabled</span><span class="p">()</span> <span class="ow">or</span> <span class="n">feature</span><span class="o">.</span><span class="n">get_parent_node</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">characteristic</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">get_characteristic</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">characteristic_can_be_notified</span><span class="p">(</span><span class="n">characteristic</span><span class="p">):</span>
            <span class="n">feature</span><span class="o">.</span><span class="n">set_notify</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_notification_status</span><span class="p">(</span><span class="n">characteristic</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span></div>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="Node.disable_notifications"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.disable_notifications">[docs]</a>    <span class="k">def</span> <span class="nf">disable_notifications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ask the node to stop notifying when a feature updates its value.</span>

<span class="sd">        Args:</span>
<span class="sd">            feature (:class:`blue_st_sdk.feature.Feature`): The given feature.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: False if the feature is not handled by this node, or it is</span>
<span class="sd">            disabled, or it is not possible to turn notifications off for it,</span>
<span class="sd">            True otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">feature</span><span class="o">.</span><span class="n">is_enabled</span><span class="p">()</span> <span class="ow">or</span> <span class="n">feature</span><span class="o">.</span><span class="n">get_parent_node</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">characteristic</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">get_characteristic</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">characteristic_can_be_notified</span><span class="p">(</span><span class="n">characteristic</span><span class="p">):</span>
            <span class="n">feature</span><span class="o">.</span><span class="n">set_notify</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">characteristic_has_other_notifying_features</span><span class="p">(</span>
                    <span class="n">characteristic</span><span class="p">,</span> <span class="n">feature</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_notification_status</span><span class="p">(</span><span class="n">characteristic</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span></div>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="Node.notifications_enabled"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.notifications_enabled">[docs]</a>    <span class="k">def</span> <span class="nf">notifications_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check whether notifications are enabled for a feature.</span>

<span class="sd">        Args:</span>
<span class="sd">            feature (:class:`blue_st_sdk.feature.Feature`): The given feature.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if notifications are enabled, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="n">feature</span><span class="o">.</span><span class="n">is_notifying</span><span class="p">()</span>

<div class="viewcode-block" id="Node.wait_for_notifications"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.wait_for_notifications">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_notifications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout_s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Block until a notification is received from the peripheral, or until</span>
<span class="sd">        the given timeout has elapsed.</span>

<span class="sd">        If a notification is received, the</span>
<span class="sd">        :meth:`blue_st_sdk.feature.FeatureListener.on_update` method of any</span>
<span class="sd">        added listener is called.</span>

<span class="sd">        Args:</span>
<span class="sd">            timeout_s (float): Time in seconds to wait before returning.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if a notification is received before the timeout elapses,</span>
<span class="sd">            False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">waitForNotifications</span><span class="p">(</span><span class="n">timeout_s</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="n">BTLEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span></div>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unexpected_disconnect</span><span class="p">()</span>

<div class="viewcode-block" id="Node.characteristic_has_other_notifying_features"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.characteristic_has_other_notifying_features">[docs]</a>    <span class="k">def</span> <span class="nf">characteristic_has_other_notifying_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">characteristic</span><span class="p">,</span> <span class="n">feature</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check whether a characteristic has other enabled features beyond the</span>
<span class="sd">        given one.</span>

<span class="sd">        Args:</span>
<span class="sd">            characteristic (Characteristic): The BLE characteristic to check.</span>
<span class="sd">            Refer to</span>
<span class="sd">            `Characteristic &lt;https://ianharvey.github.io/bluepy-doc/characteristic.html&gt;`_</span>
<span class="sd">            for more information.</span>
<span class="sd">            feature (:class:`blue_st_sdk.feature.Feature`): The given feature.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the characteristic has other enabled features beyond the</span>
<span class="sd">            given one, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_corresponding_features</span><span class="p">(</span>
                <span class="n">characteristic</span><span class="o">.</span><span class="n">getHandle</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">feature_entry</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">feature_entry</span> <span class="o">==</span> <span class="n">feature</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">feature_entry</span><span class="o">.</span><span class="n">is_notifying</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span></div>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="Node.add_listener"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.add_listener">[docs]</a>    <span class="k">def</span> <span class="nf">add_listener</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listener</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a listener.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            listener (:class:`blue_st_sdk.node.NodeListener`): Listener to</span>
<span class="sd">            be added.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">listener</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">listener</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_listeners</span><span class="p">:</span></div>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_listeners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">listener</span><span class="p">)</span>

<div class="viewcode-block" id="Node.remove_listener"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.remove_listener">[docs]</a>    <span class="k">def</span> <span class="nf">remove_listener</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listener</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove a listener.</span>

<span class="sd">        Args:</span>
<span class="sd">            listener (:class:`blue_st_sdk.node.NodeListener`): Listener to</span>
<span class="sd">            be removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">listener</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">listener</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_listeners</span><span class="p">:</span></div>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_listeners</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">listener</span><span class="p">)</span>

<div class="viewcode-block" id="Node.get_debug"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.Node.get_debug">[docs]</a>    <span class="k">def</span> <span class="nf">get_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Getting a debug console used to read/write debug messages from/to the</span>
<span class="sd">        Bluetooth device.</span>

<span class="sd">        Returns:</span>
<span class="sd">            :class:`blue_st_sdk.debug_console.DebugConsole`: A debug console</span>
<span class="sd">            used to read/write debug messages from/to the Bluetooth device.</span>
<span class="sd">            None if the device doesn&#39;t export the debug service.</span>
<span class="sd">        &quot;&quot;&quot;</span></div></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug_console</span>


<div class="viewcode-block" id="NodeDelegate"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.NodeDelegate">[docs]</a><span class="k">class</span> <span class="nc">NodeDelegate</span><span class="p">(</span><span class="n">DefaultDelegate</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Delegate class for handling Bluetooth Low Energy devices&#39; notifications.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="NodeDelegate.__init__"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.NodeDelegate.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor.</span>

<span class="sd">        Args:</span>
<span class="sd">            node (:class:`blue_st_sdk.node.Node`): The node which sends</span>
<span class="sd">            notifications.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DefaultDelegate</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_node</span> <span class="o">=</span> <span class="n">node</span></div>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;BlueSTSDK&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="NodeDelegate.handleNotification"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.NodeDelegate.handleNotification">[docs]</a>    <span class="k">def</span> <span class="nf">handleNotification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char_handle</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;It is called whenever a notification arises.</span>

<span class="sd">        Args:</span>
<span class="sd">            char_handle (int): The characteristic&#39;s handle to look for.</span>
<span class="sd">            data (str): The data notified from the given characteristic.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Calling on-read callback.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node</span><span class="o">.</span><span class="n">_debug_console</span><span class="p">:</span>
                <span class="c1"># Calling on-update callback for a debug characteristic.</span>
                <span class="n">characteristic</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">_node</span><span class="o">.</span><span class="n">_char_handle_to_characteristic_dict</span><span class="p">[</span><span class="n">char_handle</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">Debug</span><span class="o">.</span><span class="n">is_debug_characteristic</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">characteristic</span><span class="o">.</span><span class="n">uuid</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_node</span><span class="o">.</span><span class="n">_debug_console</span><span class="o">.</span><span class="n">on_update_characteristic</span><span class="p">(</span>
                        <span class="n">characteristic</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                    <span class="k">return</span>

            <span class="c1"># Calling on-read callback for the other characteristics.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_node</span><span class="o">.</span><span class="n">_update_features</span><span class="p">(</span><span class="n">char_handle</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">BlueSTInvalidDataException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">BTLEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span></div></div>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unexpected_disconnect</span><span class="p">()</span>


<div class="viewcode-block" id="NodeType"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.NodeType">[docs]</a><span class="k">class</span> <span class="nc">NodeType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Type of node.&quot;&quot;&quot;</span>

    <span class="n">GENERIC</span> <span class="o">=</span> <span class="mh">0x00</span>
    <span class="sd">&quot;&quot;&quot;Unknown device type.&quot;&quot;&quot;</span>

    <span class="n">STEVAL_WESU1</span> <span class="o">=</span> <span class="mh">0x01</span>
    <span class="sd">&quot;&quot;&quot;STEVAL-WESU1.&quot;&quot;&quot;</span>

    <span class="n">SENSOR_TILE</span> <span class="o">=</span> <span class="mh">0x02</span>
    <span class="sd">&quot;&quot;&quot;SensorTile.&quot;&quot;&quot;</span>

    <span class="n">BLUE_COIN</span> <span class="o">=</span> <span class="mh">0x03</span>
    <span class="sd">&quot;&quot;&quot;BlueCoin.&quot;&quot;&quot;</span>

    <span class="n">STEVAL_IDB008VX</span> <span class="o">=</span> <span class="mh">0x04</span>
    <span class="sd">&quot;&quot;&quot;BlueNRG1 / BlueNRG2 STEVAL.&quot;&quot;&quot;</span>

    <span class="n">STEVAL_BCN002V1</span> <span class="o">=</span> <span class="mh">0x05</span>
    <span class="sd">&quot;&quot;&quot;BlueNRG-Tile STEVAL.&quot;&quot;&quot;</span>
    
    <span class="n">SENSOR_TILE_BOX</span> <span class="o">=</span> <span class="mh">0x06</span>
    <span class="sd">&quot;&quot;&quot;SensorTile.box.&quot;&quot;&quot;</span>

    <span class="n">DISCOVERY_IOT01A</span> <span class="o">=</span> <span class="mh">0x07</span>
    <span class="sd">&quot;&quot;&quot;B-L475E-IOT01A.&quot;&quot;&quot;</span>

    <span class="n">NUCLEO</span> <span class="o">=</span> <span class="mh">0x08</span></div>
    <span class="sd">&quot;&quot;&quot;NUCLEO-based.&quot;&quot;&quot;</span>


<div class="viewcode-block" id="NodeStatus"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.NodeStatus">[docs]</a><span class="k">class</span> <span class="nc">NodeStatus</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Status of the node.&quot;&quot;&quot;</span>

    <span class="n">INIT</span> <span class="o">=</span> <span class="s1">&#39;INIT&#39;</span>
    <span class="sd">&quot;&quot;&quot;Dummy initial status.&quot;&quot;&quot;</span>

    <span class="n">IDLE</span> <span class="o">=</span> <span class="s1">&#39;IDLE&#39;</span>
    <span class="sd">&quot;&quot;&quot;Waiting for a connection and sending advertising data.&quot;&quot;&quot;</span>

    <span class="n">CONNECTING</span> <span class="o">=</span> <span class="s1">&#39;CONNECTING&#39;</span>
    <span class="sd">&quot;&quot;&quot;Opening a connection with the node.&quot;&quot;&quot;</span>

    <span class="n">CONNECTED</span> <span class="o">=</span> <span class="s1">&#39;CONNECTED&#39;</span>
    <span class="sd">&quot;&quot;&quot;Connected to the node.</span>
<span class="sd">    This status can be fired 2 times while doing a secure connection using</span>
<span class="sd">    Bluetooth pairing.&quot;&quot;&quot;</span>

    <span class="n">DISCONNECTING</span> <span class="o">=</span> <span class="s1">&#39;DISCONNECTING&#39;</span>
    <span class="sd">&quot;&quot;&quot;Closing the connection to the node.&quot;&quot;&quot;</span>

    <span class="n">LOST</span> <span class="o">=</span> <span class="s1">&#39;LOST&#39;</span>
    <span class="sd">&quot;&quot;&quot;The advertising data has been received for some time, but not anymore.&quot;&quot;&quot;</span>

    <span class="n">UNREACHABLE</span> <span class="o">=</span> <span class="s1">&#39;UNREACHABLE&#39;</span>
    <span class="sd">&quot;&quot;&quot;The node disappeared without first disconnecting.&quot;&quot;&quot;</span>

    <span class="n">DEAD</span> <span class="o">=</span> <span class="s1">&#39;DEAD&#39;</span></div>
    <span class="sd">&quot;&quot;&quot;Dummy final status.&quot;&quot;&quot;</span>


<span class="c1"># INTERFACES</span>

<div class="viewcode-block" id="NodeListener"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.NodeListener">[docs]</a><span class="k">class</span> <span class="nc">NodeListener</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Interface used by the :class:`blue_st_sdk.node.Node` class to notify</span>
<span class="sd">    changes of a node&#39;s status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

<div class="viewcode-block" id="NodeListener.on_status_change"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.NodeListener.on_status_change">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">on_status_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">new_status</span><span class="p">,</span> <span class="n">old_status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;To be called whenever a node changes its status.</span>

<span class="sd">        Args:</span>
<span class="sd">            node (:class:`blue_st_sdk.node.Node`): Node that has changed its</span>
<span class="sd">            status.</span>
<span class="sd">            new_status (:class:`blue_st_sdk.node.NodeStatus`): New status.</span>
<span class="sd">            old_status (:class:`blue_st_sdk.node.NodeStatus`): Old status.</span>

<span class="sd">        Raises:</span>
<span class="sd">            :exc:`NotImplementedError` if the method has not been implemented.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;You must implement &quot;on_status_change()&quot; to &#39;</span></div>
                                  <span class="s1">&#39;use the &quot;NodeListener&quot; class.&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="NodeListener.on_connect"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.NodeListener.on_connect">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">on_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;To be called whenever a node connects to a host.</span>

<span class="sd">        Args:</span>
<span class="sd">            node (:class:`blue_st_sdk.node.Node`): Node that has connected to a</span>
<span class="sd">                host.</span>

<span class="sd">        Raises:</span>
<span class="sd">            :exc:`NotImplementedError` if the method has not been implemented.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;You must implement &quot;on_connect()&quot; to &#39;</span></div>
                                  <span class="s1">&#39;use the &quot;NodeListener&quot; class.&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="NodeListener.on_disconnect"><a class="viewcode-back" href="../../blue_st_sdk.html#blue_st_sdk.node.NodeListener.on_disconnect">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">on_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">unexpected</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;To be called whenever a node disconnects from a host.</span>

<span class="sd">        Args:</span>
<span class="sd">            node (:class:`blue_st_sdk.node.Node`): Node that has disconnected</span>
<span class="sd">            from a host.</span>
<span class="sd">            unexpected (bool, optional): True if the disconnection is unexpected,</span>
<span class="sd">            False otherwise (called by the user).</span>

<span class="sd">        Raises:</span>
<span class="sd">            :exc:`NotImplementedError` if the method has not been implemented.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;You must implement &quot;on_disconnect()&quot; to &#39;</span></div></div>
                                  <span class="s1">&#39;use the &quot;NodeListener&quot; class.&#39;</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Davide Aliprandi.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>